(function(e,t,n,r){"use strict";e(n).ready(function(){e(".abo-commerce-container").aboCommerce()})})(jQuery,window,document),function(e,t,n,r){"use strict";function o(t,n){var o=this;o.$el=e(t),o.options=e.extend({},s,n),o._defaults=s,o._name=i,o.$deliveryContainer=e(".delivery-interval-container"),o.$quantityBox=e("#detailCartButton");var u=e(".abocommerce-data").html();u=e.parseJSON(u),o._prices=u.prices,u=r,o.init()}var i="aboCommerce",s={popUpOffsetTop:32,fadeSpeed:"fast",activeCls:"active",hiddenCls:"hidden"};o.prototype={_deliveryState:"open",_orderlistPopupState:"closed",_pricelistPopupState:"closed",$deliveryContainer:r,$quantityBox:r,_prices:r,_deliveryInterval:r,_durationInterval:r,init:function(){var n=this,r=n.$el.find(".selection"),i=r.val();n[i==="single"?"hide":"show"](),r.bind("change",function(){var t=e(this).val();if(t===i)return!1;n[t==="single"?"hide":"show"](),i=t}),n.initOrderlistPopup(),n.initPricePopup(),e(t).bind("resize",{self:n},n.onWindowResize).trigger("resize"),n.$el.find(".duration-interval").bind("change",function(){var t=e(this),r=1*~~t.val();n.setDuration(r),n.refreshPriceDisplay(r)}),n.$el.find(".delivery-interval").bind("change",function(){var t=e(this),r=1*~~t.val();n.setDelivery(r)})},initOrderlistPopup:function(){var t=this;return t.$orderlistPopup=e(".orderlist-popup").hide(),t.$orderlistLink=e(".open-orderlist-popup"),t.$orderlistLink.bind("click",{self:t},t.onOpenOrderlistPopup),t.$orderlistPopup.find(".btn-add-to-orderlist").bind("click",{self:t},t.onSaveToOrderlist),!0},showOrderlistPopup:function(){var e=this;return e.$orderlistPopup.fadeIn(e.options.fadeSpeed),e._orderlistPopupState="open",!0},hideOrderlistPopup:function(){var e=this;return e.$orderlistPopup.fadeOut(e.options.fadeSpeed),e._orderlistPopupState="closed",!0},toggleOrderlistPopup:function(){var e=this;return e[e._orderlistPopupState==="open"?"hideOrderlistPopup":"showOrderlistPopup"]()},initPricePopup:function(){var t=this;return t.$pricelistPopup=e(".price-separation-popup").hide(),t.$pricelistLink=e(".link-open-price-separation"),t.$pricelistLink.bind("click",function(){t.togglePricelistPopup()}),!0},showPricelistPopup:function(){var e=this;return e.$pricelistPopup.fadeIn(e.options.fadeSpeed),e._pricelistPopupState="open",!0},hidePricelistPopup:function(){var e=this;return e.$pricelistPopup.fadeOut(e.options.fadeSpeed),e._pricelistPopupState="closed",!0},togglePricelistPopup:function(){var e=this;return e[e._pricelistPopupState==="open"?"hidePricelistPopup":"showPricelistPopup"]()},onSaveToOrderlist:function(n){n.preventDefault();var i=n.data.self,s=i.$orderlistLink.attr("data-ordernumber"),o=i.$orderlistPopup.find(".orderlist-select :selected").val(),u=i.$orderlistPopup.find("form");if(!s)return!1;var a=e("<div>",{"class":"orderlist-overlay"}).hide().prependTo(i.$orderlistPopup).fadeIn(i.options.fadeSpeed);e.ajax({url:u.attr("action"),type:u.attr("method"),data:{sOrdernumber:s,sOrderlist:o},success:function(){var e=t.setTimeout(function(){a.hide().remove(),i.hideOrderlistPopup(),t.clearTimeout(e),e=r},500)}})},onWindowResize:function(e){var t=e.data.self,n=t.$orderlistLink.offset(),r=t.$pricelistLink.offset();n&&(n.top=n.top+t.options.popUpOffsetTop,t.$orderlistPopup.css(n)),r&&(r.left+=t.$pricelistLink.width()+35,r.top-=40,t.$pricelistPopup.css(r))},onOpenOrderlistPopup:function(t){t.preventDefault();var n=t.data.self,r=e(this),i=r.attr("data-ordernumber");return i?(r[r.hasClass(n.options.activeCls)?"removeClass":"addClass"](n.options.activeCls),n.toggleOrderlistPopup(),!0):!1},hide:function(){var e=this;e.$deliveryContainer.addClass(e.options.hiddenCls),e.$quantityBox.find(".abo-delivery").addClass(e.options.hiddenCls).find(".sQuantity").attr("disabled","disabled"),e.$quantityBox.find(".single-delivery").removeClass(e.options.hiddenCls).removeAttr("disabled"),e._removeHiddenFields(),e._deliveryState="closed"},show:function(){var e=this;e.$deliveryContainer.removeClass(e.options.hiddenCls),e.$quantityBox.find(".abo-delivery").removeClass(e.options.hiddenCls).find(".sQuantity").removeAttr("disabled"),e.$quantityBox.find(".single-delivery").addClass(e.options.hiddenCls).find(".sQuantity").attr("disabled","disabled"),e._injectHiddenFields(),e._deliveryState="open"},toggle:function(){var e=this;return e[e._deliveryState==="open"?"hide":"show"]()},refreshPriceDisplay:function(t){var n=this,r=n._getPrice(t),i=n.$el.find(".abo-pseudo-price"),s=r.descountPercentage;i.find("span.percent").html(e.number_format(s,2,",",".")),i.find("span.price").html(e.number_format(r.discountPrice,2,",",".")+"&nbsp;&euro;")},setDelivery:function(e){var t=this;return!e||!t._deliveryInterval?!1:(t._deliveryInterval.val(e),!0)},setDuration:function(e){var t=this;return!e||!t._durationInterval?!1:(t._durationInterval.val(e),!0)},_getPrice:function(e){var t=this,n;for(var r in t._prices){var i=t._prices[r];e>=i.duration&&(n=i)}return n},_injectHiddenFields:function(){var t=this,n=e("form.basketform");return t._deliveryState?(t._durationInterval=e("<input/>",{type:"hidden",name:"sDurationInterval",value:t.$el.find(".duration-interval :selected").val()}).prependTo(n),t._deliveryInterval=e("<input/>",{type:"hidden",name:"sDeliveryInterval",value:t.$el.find(".delivery-interval :selected").val()}).prependTo(n),!0):!1},_removeHiddenFields:function(){var e=this;return e._deliveryState?(e._durationInterval&&(e._durationInterval.remove(),e._durationInterval=r),e._deliveryInterval&&(e._deliveryInterval.remove(),e._deliveryInterval=r),!0):!1}},e.fn[i]=function(t){return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new o(this,t))})}}(jQuery,window,document);