(function(){tinymce.create('tinymce.plugins.MediaSelectionPlugin',{ed:null,imageCls:'tinymce-editor-image',linkCls:'tinymce-editor-link',videoCls:'tinymce-editor-video',audioCls:'tinymce-editor-audio',init:function(a,b){var c=this;c.ed=a;a.addCommand('mceMediaSelection',function(){if(typeof(Shopware.app.Application.addSubApplication)!=='function'){Ext.Error.raise({msg:'Your ExtJS application does not support sub applications',option:[a,b]})}Shopware.app.Application.addSubApplication({name:'Shopware.apps.MediaManager',layout:'small',selectionMode:'single',eventScope:c,mediaSelectionCallback:c._processImage})});a.addButton('media_selection',{title:'Media Selection',cls:'tinymce-media-selection',cmd:'mceMediaSelection',image:b+'/icons/inbox-image.png'})},getInfo:function(){return{longname:'MediaManager - MediaSelection',author:'shopware AG - st.pohl',authorurl:'http://www.shopware.de',infourl:'http://wiki.shopware.de/',version:'1.0.0'}},_processImage:function(c){var d=this,ed=d.ed,win=c.up('window'),dataPnl=win.down('.mediamanager-media-view'),dataView=dataPnl.dataView,selModel=dataView.getSelectionModel(),selected=selModel.getSelection();Ext.each(selected,function(a){var b=a.get('type');if(b==='VIDEO'){d._insertVideo(a)}else if(b==='IMAGE'){d._insertImage(a)}else if(b==='MUSIC'){d._insertAudio(a)}else{d._insertLink(a)}ed.undoManager.add()});win.destroy()},_insertImage:function(a){var b=this,ed=b.ed,settings=ed.settings,path,args;if(settings.document_base_url.length&&settings.relative_urls==false){path=settings.document_base_url+a.get('path')}else path=a.get('path');args={'class':b.imageCls,width:a.get('width'),height:a.get('height'),alt:a.get('name'),src:path};ed.execCommand('mceInsertContent',false,tinymce.DOM.createHTML('img',args),{skip_undo:1});return true},_insertLink:function(a){var b=this,ed=b.ed,args;args={'class':b.linkCls,href:a.get('path'),title:a.get('name'),target:'_blank'};ed.execCommand('mceInsertContent',false,tinymce.DOM.createHTML('a',args,a.get('name')),{skip_undo:1});return true},_insertVideo:function(a){var b=this,ed=b.ed,args;args={'class':b.videoCls,width:320,height:240,src:ed.settings.document_base_url+a.get('path'),controls:true};ed.execCommand('mceInsertContent',false,tinymce.DOM.createHTML('video',args),{skip_undo:1});return true},_insertAudio:function(a){var b=this,ed=b.ed,args;args={'class':b.audioCls,src:ed.settings.document_base_url+a.get('path'),controls:true};ed.execCommand('mceInsertContent',false,tinymce.DOM.createHTML('audio',args),{skip_undo:1});return true}});tinymce.PluginManager.add('media_selection',tinymce.plugins.MediaSelectionPlugin)})();